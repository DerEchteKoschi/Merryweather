{% extends 'base.html.twig' %}

{% block title %}{{ 'slotbooking'|trans }}{% endblock %}

{% block javascripts %}
    {% if appConfig.mercureActive %}
    <script>
        const me = {{ app.user.id }};
        const eventSource = new EventSource("{{ mercure('booking')|escape('js') }}");
        eventSource.onmessage = event => {
            const data = JSON.parse(event.data);
            if (!data.hasOwnProperty('owner') || !data.hasOwnProperty('slotId')) {
                console.log('incompatible data received', data);
                return;
            }
            if (data.owner === me) {
                $.ajax("{{ path('app_slot_list') }}").done(function (response) {
                    $('#slotlist').replaceWith(response);
                });
            } else {
                $.ajax("{{ path('app_slot_row', {slotId: -1}) }}".replace('-1', data.slotId)).done(function (response) {
                    $('#slot_' + data.slotId).replaceWith(response);
                });
            }
        }
    </script>
    {%  endif %}
{% endblock %}

{% block body %}
{{ include('slot_booking/list.html.twig') }}
{% endblock %}
